<!DOCTYPE html>
<html lang="pt-BR" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VIVO ESSENTIAL - Plataforma</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/style.css" />
    <style>
      body {
        font-family: 'Inter', sans-serif;
        transition: background-color 0.3s ease, color 0.3s ease;
      }
      /* Estilos para o link ativo da sidebar */
      html:not(.dark) .sidebar-link.active {
        background-color: #4f46e5;
        color: white;
      }
      html:not(.dark) .sidebar-link:not(.active):hover {
        background-color: #6366f1;
      }
      html.dark .sidebar-link.active {
        background-color: #6d28d9;
        color: white;
      }
      html.dark .sidebar-link:not(.active):hover {
        background-color: #5b21b6;
      }

      .profile-specific-content {
        padding: 1.5rem;
        margin-top: 1.5rem;
        border-radius: 0.75rem;
        min-height: 200px;
        transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
      }
      html:not(.dark) .profile-specific-content {
        border: 1px dashed #a78bfa;
        background-color: #f9fafb;
        color: #1f2937;
      }
      html.dark .profile-specific-content {
        border: 1px dashed #8b5cf6;
        background-color: rgba(55, 65, 81, 0.5);
        color: #d1d5db;
      }
    </style>
  </head>
  <body
    class="bg-gray-100 text-gray-900 dark:bg-slate-900 dark:text-slate-200 selection:bg-purple-400 dark:selection:bg-purple-500 selection:text-white transition-colors duration-300"
  >
    <div class="flex h-screen overflow-hidden">
      <aside
        class="w-64 bg-white dark:bg-slate-800 p-6 flex flex-col justify-between shadow-xl flex-shrink-0 transition-colors duration-300"
      >
        <div>
          <div class="mb-10 text-center">
            <img src="imagens/logo-vivo.svg" alt="Logo VIVO" class="w-28 h-auto mx-auto mb-1" />
            <span class="text-2xl font-bold text-purple-700 dark:text-purple-400">ESSENTIAL</span>
          </div>
          <nav>
            <ul>
              <li class="mb-3">
                <a
                  href="telainicial.html"
                  id="homeLink"
                  class="sidebar-link flex items-center py-3 px-4 rounded-lg text-gray-700 dark:text-slate-100 transition-colors duration-200"
                >
                  <span class="mr-3">üè†</span> Home
                </a>
              </li>
              <li class="mb-3">
                <a
                  href="perfil.html"
                  id="perfilLink"
                  class="sidebar-link flex items-center py-3 px-4 rounded-lg text-gray-700 dark:text-slate-100 transition-colors duration-200"
                >
                  <span class="mr-3">üë§</span> Meu Perfil
                </a>
              </li>
              <li class="mb-3">
                <a
                  href="#"
                  id="vivinhoLink"
                  class="sidebar-link flex items-center py-3 px-4 rounded-lg text-gray-700 dark:text-slate-100 transition-colors duration-200"
                >
                  <span class="mr-3">üí¨</span> Q Vivinho IA
                  <span class="ml-auto text-xs text-purple-700 dark:text-purple-400">‚ú®</span>
                </a>
              </li>
              <li class="mb-3">
                <a
                  href="#"
                  id="cursosLink"
                  class="sidebar-link flex items-center py-3 px-4 rounded-lg text-gray-700 dark:text-slate-100 transition-colors duration-200"
                >
                  <span class="mr-3">üìö</span> Meus Cursos
                </a>
              </li>
              <li class="mb-3">
                <a
                  href="#"
                  id="gamificacaoLink"
                  class="sidebar-link flex items-center py-3 px-4 rounded-lg text-gray-700 dark:text-slate-100 transition-colors duration-200"
                >
                  <span class="mr-3">üèÜ</span> Gamifica√ß√£o Vivo
                </a>
              </li>
              <li class="mb-3">
                <a
                  href="#"
                  id="desempenhoLink"
                  class="sidebar-link flex items-center py-3 px-4 rounded-lg text-gray-700 dark:text-slate-100 transition-colors duration-200"
                >
                  <span class="mr-3">üìä</span> Desempenho
                </a>
              </li>
            </ul>
          </nav>
        </div>
        <div class="text-center text-xs text-gray-500 dark:text-slate-500">
          &copy; <span id="currentYearSidebar"></span> VIVO ESSENTIAL
        </div>
      </aside>

      <div class="flex-1 flex flex-col overflow-hidden">
        <header
          class="bg-white dark:bg-slate-800 shadow-md p-4 flex justify-between items-center flex-shrink-0 transition-colors duration-300"
        >
          <h2 class="text-xl font-semibold text-gray-800 dark:text-slate-200" id="pageTitle">
            Painel Principal
          </h2>
          <div class="flex items-center space-x-3">
            <button
              id="themeToggleButton"
              title="Alternar tema"
              class="p-2 rounded-full text-gray-600 dark:text-slate-400 hover:bg-gray-200 dark:hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-purple-500 dark:focus:ring-purple-600 transition-colors duration-200"
            >
              <span id="themeIcon" class="text-xl"></span>
            </button>
            <button
              title="Notifica√ß√µes"
              class="p-2 rounded-full text-gray-600 dark:text-slate-400 hover:bg-gray-200 dark:hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-purple-500 dark:focus:ring-purple-600 transition-colors duration-200"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"
                />
              </svg>
            </button>
            <div class="relative">
              <button
                class="flex items-center text-gray-900 dark:text-slate-200 p-1 rounded-lg hover:bg-gray-200 dark:hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-purple-500 dark:focus:ring-purple-600 transition-colors duration-200"
              >
                <img
                  class="h-8 w-8 rounded-full object-cover mr-2 border-2 border-transparent"
                  src="imagens/logo-vivo.svg"
                  alt="Avatar do Usu√°rio"
                  id="userAvatarHeader"
                />
                <span id="userNameHeader" class="font-medium">Carregando...</span>
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-5 w-5 ml-1 text-gray-500 dark:text-slate-400"
                  viewBox="0 0 20 20"
                  fill="currentColor"
                >
                  <path
                    fill-rule="evenodd"
                    d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                    clip-rule="evenodd"
                  />
                </svg>
              </button>
            </div>
            <button
              id="logoutButtonHeader"
              class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-3 rounded-lg text-sm transition duration-300 ease-in-out"
            >
              Sair
            </button>
          </div>
        </header>

        <main
          class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-200 dark:bg-gradient-to-br dark:from-slate-900 dark:via-purple-900 dark:to-indigo-950 p-6 md:p-8 transition-colors duration-300"
        >
          <div
            class="bg-white dark:bg-slate-800 dark:bg-opacity-70 dark:backdrop-blur-sm rounded-xl shadow-xl p-8 md:p-12 w-full max-w-4xl mx-auto text-center"
          >
            <h1
              id="welcomeTitle"
              class="text-2xl sm:text-3xl md:text-4xl font-extrabold text-purple-600 dark:text-purple-300 mb-3"
            >
              Carregando...
            </h1>
            <div id="userInfo" class="text-md text-gray-700 dark:text-slate-300 mb-5"></div>
            <div id="profileSpecificContent" class="profile-specific-content text-left">
              <p>Verificando seu perfil para carregar o conte√∫do apropriado...</p>
            </div>
          </div>
        </main>
      </div>
    </div>
    <button
      title="Ajuda"
      class="fixed bottom-6 right-6 bg-purple-600 hover:bg-purple-700 text-white p-4 rounded-full shadow-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 dark:focus:ring-offset-slate-900 focus:ring-offset-gray-100 transition-transform duration-200 hover:scale-110"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-8 w-8"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        stroke-width="2"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.755 4 3.92C16 12.897 14.703 14 12.75 14c-.897 0-1.7-.398-2.25-.996A2.032 2.032 0 018.228 9z"
        />
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M12 18a6 6 0 100-12 6 6 0 000 12z"
        />
      </svg>
    </button>

    <script>
      document.addEventListener('DOMContentLoaded', async function () {
        const welcomeTitleElement = document.getElementById('welcomeTitle');
        const userInfoElement = document.getElementById('userInfo');
        const profileSpecificContentElement = document.getElementById('profileSpecificContent');
        const logoutButtonHeader = document.getElementById('logoutButtonHeader');
        const currentYearSidebarElement = document.getElementById('currentYearSidebar');
        const userNameHeaderElement = document.getElementById('userNameHeader');
        const pageTitleElement = document.getElementById('pageTitle');

        // Assegura que o link da p√°gina atual est√° ativo na barra lateral
        const currentPage = window.location.pathname.split('/').pop();
        let activeLinkId = 'homeLink';
        let title = 'Painel Principal';

        if (currentPage === 'perfil.html') {
          activeLinkId = 'perfilLink';
          title = 'Meu Perfil';
        } else if (currentPage === 'telainicial-buddy.html') {
          activeLinkId = 'homeLink'; // Ou um link espec√≠fico para a home do buddy
          title = 'Painel do Buddy';
        } else if (currentPage === 'telainicial-gestor.html') {
          activeLinkId = 'homeLink'; // Ou um link espec√≠fico para a home do gestor
          title = 'Painel do Gestor';
        }
        // Adicione mais verifica√ß√µes para outras p√°ginas se necess√°rio
        document
          .querySelectorAll('.sidebar-link')
          .forEach((link) => link.classList.remove('active'));
        const activeElement = document.getElementById(activeLinkId);
        if (activeElement) {
          activeElement.classList.add('active');
        }
        if (pageTitleElement) {
          pageTitleElement.textContent = title;
        }

        if (currentYearSidebarElement) {
          currentYearSidebarElement.textContent = new Date().getFullYear();
        }

        const accessToken = localStorage.getItem('accessToken');

        function redirectToLogin(message) {
          alert(message + ' Redirecionando para login...');
          localStorage.removeItem('accessToken');
          localStorage.removeItem('userData');
          window.location.href = 'login.html';
        }

        // Comente este bloco para desativar o login durante o desenvolvimento
        // if (!accessToken) {
        //   redirectToLogin('Acesso negado. Token n√£o encontrado.');
        //   return;
        // }

        // Tente carregar os dados do perfil do usu√°rio
        try {
          const profileResponse = await fetch('http://localhost:3000/auth/profile', {
            method: 'GET',
            headers: { Authorization: `Bearer ${accessToken}` },
          });

          if (profileResponse.ok) {
            const userProfileData = await profileResponse.json();
            localStorage.setItem('userData', JSON.stringify(userProfileData));

            if (welcomeTitleElement) {
              welcomeTitleElement.textContent = `Ol√°, ${userProfileData.nomeCompleto}!`;
            }
            if (userNameHeaderElement) {
              userNameHeaderElement.textContent = userProfileData.nomeCompleto;
            }

            // --- L√≥gica para conte√∫do espec√≠fico por perfil ---
            if (profileSpecificContentElement) {
              const titleColor = 'text-purple-600 dark:text-purple-300';
              const textColor = 'text-gray-700 dark:text-slate-300';

              switch (userProfileData.tipoPerfil) {
                case 'GESTOR':
                  profileSpecificContentElement.innerHTML = `<h2 class="text-xl font-semibold mb-3 ${titleColor}">Painel do Gestor</h2><p class="${textColor}">Vis√£o geral da equipe, progresso de onboarding e ferramentas de gerenciamento.</p>`;
                  break;
                case 'BUDDY':
                  profileSpecificContentElement.innerHTML = `<h2 class="text-xl font-semibold mb-3 ${titleColor}">√Årea do Buddy</h2><p class="${textColor}">Acompanhe seus novos colegas, acesse recursos e agende intera√ß√µes.</p>`;
                  break;
                case 'NOVO_COLABORADOR':
                  profileSpecificContentElement.innerHTML = `<h2 class="text-xl font-semibold mb-3 ${titleColor}">Sua Jornada de Onboarding</h2><p class="${textColor}">Bem-vindo(a)! Aqui voc√™ encontrar√° suas trilhas, tarefas e pr√≥ximos passos.</p>`;
                  break;
                default:
                  profileSpecificContentElement.innerHTML = `<p class="${textColor}">Perfil de usu√°rio n√£o reconhecido.</p>`;
              }
            }
          } else {
            const errorData = await profileResponse
              .json()
              .catch(() => ({ message: 'Sess√£o inv√°lida ou expirada.' }));
            // Note que o redirecionamento est√° comentado para desenvolvimento
            // redirectToLogin(errorData.message || `Erro ${profileResponse.status}: Sess√£o inv√°lida.`);
            console.error('Falha ao buscar perfil do backend:', errorData);
          }
        } catch (e) {
          console.error('Erro de comunica√ß√£o ao buscar perfil:', e);
          // Note que o redirecionamento est√° comentado para desenvolvimento
          // redirectToLogin('Erro de comunica√ß√£o ao buscar perfil.');
        }

        if (logoutButtonHeader) {
          logoutButtonHeader.addEventListener('click', function () {
            localStorage.removeItem('accessToken');
            localStorage.removeItem('userData');
            alert('Voc√™ saiu da plataforma.');
            window.location.href = 'login.html';
          });
        }
      });
    </script>
    <script src="js/theme-switcher.js"></script>
  </body>
</html>
